\documentclass[final,20pt]{beamer}

\usepackage[orientation=portrait,size=a0,scale=1.6]{beamerposter}
\usepackage{wrapfig}
\usepackage[english]{babel}
\usepackage{listings}
\usepackage{verbatimbox}
\usepackage{filecontents}
\usepackage{hhline}
\usepackage{tikz}
\usepackage{comment}
\usepackage{mathtools}
\usepackage{fancybox}
\usepackage{ragged2e}
\usepackage[font={large}]{caption}
\usetikzlibrary{backgrounds,tikzmark}

\captionsetup[figure]{labelformat=empty}

\usepackage[backend=bibtex,style=numeric,maxnames=2,firstinits=true]{biblatex}
\addbibresource{poster.bib}

%% \usepackage[backend=bibtex,style=numeric,maxnames=2,firstinits=true]{biblatex}

\usetheme{confposter} % Use the confposter theme supplied with this template

%% \setbeamercolor{titlelike}         {bg=jblue,fg=white}
\setbeamercolor{block title example}{fg=white,bg=dgreen!70}
\setbeamercolor{block body example}{fg=black,bg=dgreen!10}
\setbeamercolor{block title}{fg=white,bg=jblue!70} % Colors of the block titles
\setbeamercolor{block body}{fg=black,bg=white} % Colors of the body of blocks
\setbeamercolor{block alerted title}{fg=white,bg=jblue!70} % Colors of the highlighted block titles
\setbeamercolor{block alerted body}{fg=black,bg=dblue!10} % Colors of the body of highlighted blocks
%\setbeamercolor{block example title}{fg=black,bg=dblue!70} % Colors of the example block titles
%\setbeamercolor{block example body}{fg=black,bg=dblue!10} % Colors of the body of example blocks
% Many more colors are available for use in beamerthemeconfposter.sty

% Define the column widths and overall poster size
\input{sizeDefs}
%% \input{sizeDefsVert}            

\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{wasysym}
\usepackage{comment}

%% \bibliography{../references,../proceedings}

%% \input{../defs}
%% \input{../abbrevmap}
%% \lstset{escapeinside=||,basicstyle=\large}
%% \input{posterDefs}

\lstdefinelanguage{ocanren}{
keywords={fresh, let, in, match, with, when, class, type,
object, method, of, rec, while, not, do, done, as, val, inherit,
new, module, sig, deriving, datatype, struct, if, then, else, open, private, virtual, include, success, failure},
sensitive=true,
commentstyle=\small\itshape\ttfamily,
keywordstyle=\ttfamily\underbar,
identifierstyle=\ttfamily,
basewidth={0.5em,0.5em},
columns=fixed,
fontadjust=true,
literate={fun}{{$\lambda$}}1 {->}{{$\to$}}3 {===}{{$\equiv$}}1 {=/=}{{$\not\equiv$}}1 {|>}{{$\triangleright$}}3 {/\\}{{$\wedge$}}2 {\\/}{{$\vee$}}2 {^}{{$\uparrow$}}1,
morecomment=[s]{(*}{*)},
escapechar=~
}

\lstset{
mathescape=true,
%basicstyle=\small,
identifierstyle=\ttfamily,
keywordstyle=\bfseries,
commentstyle=\scriptsize\rmfamily,
basewidth={0.5em,0.5em},
fontadjust=true,
language=ocanren
}

%% \lstset{escapeinside=||}        

%% \setbeamertemplate{itemize item}{\color{\dbluecolor}$\blacktriangleright$}
%% \setbeamertemplate{itemize subitem}{\color{\bluecolor}$\blacktriangleright$}

\newcommand*{\code}[1]{\texttt{#1}}
\newcommand{\ocanren}[1]{\mbox{\lstinline|#1|}}
\newcommand{\Xrightarrow}[1]{\xrightarrow{\phantom{x}#1\phantom{x}}}
\newcommand\NoIndent[1]{%
  \begingroup
  \par
  \parshape0
  #1\par
  \endgroup
}

\makeatletter
\newenvironment{CenteredBox}{% 
\begin{Sbox}}{% Save the content in a box
\end{Sbox}\centerline{\parbox{\wd\@Sbox}{\TheSbox}}}% And output it centered
\makeatother

\begin{filecontents*}{appendo.ml}
let rec append$^o$ x y xy =
  (x === [] /\ y === xy) \/
  (fresh (h t ty) 
    (x === h :: t) /\
    (append$^o$ t y ty) /\
    (xy === h :: ty)
  )
\end{filecontents*}

\begin{filecontents*}{appendorun.ml}

run 1 (fun q -> append$^o$ [1; 2] [3] q) $\leadsto$ {q=[1; 2; 3]}

run 3 (fun q r -> append$^o$ q r [1; 2]) $\leadsto$ {q=[ ], r=[1; 2];
~\phantom{run 3 (fun q r -> append$^o$ q r [1; 2]) $\leadsto$ \{}~      q=[1], r=[2];
~\phantom{run 3 (fun q r -> append$^o$ q r [1; 2]) $\leadsto$ \{}~      q=[1; 2], r=[ ]}
\end{filecontents*}

\begin{filecontents*}{sorto.ml}
let rec sort$^o$ xs ys =
  (xs === [] /\ ys === []) \/
  (fresh (s xst yst) 
    (ys === s :: yst) /\
    (smallest$^o$ xs s xst) /\  (*1*)
    (sort$^o$ xst yst)~\phantom{$\wedge$}~         (*2*)
  )
\end{filecontents*}

\begin{filecontents*}{permo.ml}
let perm$^o$ xs ys = 
   fresh (ts)
      (sort$^o$ xs ts) /\ 
      (sort$^o$ ys ts)    
\end{filecontents*}

\begin{filecontents*}{divo.ml}
let rec div$^o$ n m q r =
  (r === n /\ [] === q /\ plus$^o$ r m n /\ lt$^o$ r m) \/
  ([1] === q /\ eql$^o$ n m /\ plus$^o$ r m n /\ lt$^o$ r m) \/
  ((ltl$^o$ m n) /\ (lt$^o$ r m) /\ (pos$^o$ q) /\
   (fresh (nh nl qh ql qlm qlmr rr rh) (
     (split$^o$ n r nl nh) /\ (split$^o$ q r ql qh) /\
     ((([] === nh) /\ ([] === qh) /\ (minus$^o$ nl r qlm) /\ (mult$^o$ ql m qlm)) \/
       ((pos$^o$ nh) /\ (mult$^o$ ql m qlm) /\ (plus$^o$ qlm r qlmr) /\
       (minus$^o$ qlmr nl rr) /\ (split$^o$ rr r [] rh) /\ (div$^o$ nh m qh rh))
     )
   ))
  )
\end{filecontents*}

\begin{filecontents*}{divoeasy.ml}
let div$^o$ n m q r =
  fresh (mq) 
    (mult$^o$ m q mq) /\ 
    (plus$^o$ mq r n) /\ 
    (lt$^o$ r m)    
\end{filecontents*}


%----------------------------------------------------------------------------------------
%	TITLE SECTION 
%----------------------------------------------------------------------------------------

\title[Improving Refutational Completeness \\ of Relational Search]{Improving Refutational Completeness \\ of Relational Search}

\author
{Dmitri Rozplokhas}% \quad Dmitri Boulytchev\inst{2}}

\institute{
  Saint Petersburg Academic University, JetBrains Research, Russia% \quad
%  \inst{2}%
%  Saint Petersburg State University, JetBrains, Russia
}

%% \vspace*{.5cm}
%% {\normalsize
%% GitHub: \textbf{anlun/OperationalSemanticsC11}
%% \quad 
%% E-mail: \textbf{a.podkopaev@2009.spbu.ru}
%% }
%% \vspace*{-1cm}

%----------------------------------------------------------------------------------------
\sloppy
\begin{document}

\addtobeamertemplate{headline}{} 
{
\begin{tikzpicture}[remember picture,overlay] 
\node [shift={(-10 cm,-13cm)}] at (current page.north east) {\includegraphics[height=10cm]{jetbrains_logo}}; 
\node [shift={(10 cm,-13cm)}] at (current page.north west) {\includegraphics[height=10cm]{AU_logo}}; 
\end{tikzpicture} 
}

%% \addtobeamertemplate{block end}{}{\vspace*{1ex}} % White space under blocks
%% \addtobeamertemplate{block alerted end}{}{\vspace*{1ex}} % White space under highlighted (alert) blocks

\setlength{\belowcaptionskip}{2ex} % White space under figures
\setlength\belowdisplayshortskip{2ex} % White space under equations

\begin{frame}[t] % The whole poster is enclosed in one beamer frame

\begin{columns}[t]
  \begin{column}{\sepwid}\end{column} % Empty spacer column

  \begin{column}{\onecolwid} % The first column
  
    \begin{block}{Relational Programming}
      \vskip7mm
      
      {\Large
        $$\mbox{\emph{Functions}} \Rightarrow \mbox{\emph{Relations}}$$
      }
      {\large In relational world:
       \vskip7mm
      \begin{center}
        \textbf{\textcolor{blue}{
        \begin{tabular}{rcl}
          sorting        & $\leftrightarrow$ & permutations\\
          type inference & $\leftrightarrow$ & type inhabitation\\
           interpretation & $\leftrightarrow$ & program synthesis
        \end{tabular}}}
      \end{center}
      }
      
      %{\Large
      %$$
      %   \begin{array}{c}
      %   \mbox{Programs as \emph{functions}}\\
      %   \Downarrow\\
      %   \mbox{Programs as \emph{relations}}
      %   \end{array}
      %$$}
      %\vskip8mm
      
      %\centerline{\large programs as \emph{functions}} 
      % begin{center} \large programs as \emph{functions} \end{center}
     % to \\
      %\centerline{\large programs as \emph{relations}}
      %\begin{center} \large programs as \emph{relations} \end{center}
      
      MiniKanren~\cite{friedman2005reasoned}~--- a small relational DSL
      %\end{center}
      
      %[Friedman, Byrd, Kiselyov, 2005]:
%      \begin{itemize}
%       \item 4 relational constructors
%        \item some host language (Scheme, Racket, Clojure, Haskell, \textbf{OCaml}).
%     \end{itemize}
      \vskip8mm
      \begin{exampleblock}{\centering Relational List Concatenation}
         \begin{CenteredBox}
            \lstinputlisting{appendo.ml}
          \end{CenteredBox}
        \lstinputlisting{appendorun.ml}
      \end{exampleblock}
      
      
    \end{block}
    
    \begin{block}{Refutational completeness}
    \vskip7mm

      \begin{itemize}
        \item MiniKanren search is complete, but can diverge when no answers exist:
        \vskip8mm
        \lstinline|run* (fun q r -> append$^o\;$ q r [1; 2]) $\; \leadsto \;$ $\bot$|
        \vskip8mm
       \item \textbf{Refutational completeness}~\cite{byrd2009relational}: any query terminates when no answers left.
       \end{itemize}
       \vskip1cm
      
       %Relational specification is \textbf{refutationally complete} [Byrd, 2009], if any query terminates when no answers left.
       
       \large Many important specifications are refutationally incomplete.
       \vskip1cm
       
    \end{block}
    
    \begin{block}{Existing techniques}
    \vskip7mm

	\begin{itemize}
		\item Moving a recursive call to the end
		
		\item Bounding the sizes of terms:
		
	   \vskip8mm
	   \begin{exampleblock}{\centering Binary Division with reminder}
        \justifying
        Changing definition-based natural implementation:

        \bigskip
            \lstinputlisting{divoeasy.ml}
        \bigskip
        
        to a sophisticated recursive solution~\cite{Kiselyov:2008:PDC:1788446.1788456} of 20 LOC.
      \end{exampleblock}
		
		\item lots of others
	\end{itemize}
       
    \end{block}
    
   
    
    %\begin{block}{Possible solutions}
     % \begin{enumerate}
     %   \item Advanced technics of writing specifications, \\ such as bounding the sizes of terms
     %   \item Simulation of commutative conjunction
     %   \item Reordering of conjuncts during execution
     %   \item[\textcolor{red}{$\uparrow$}] \textcolor{red}{ \textbf{our approach} }
     % \end{enumerate}
    %\end{block}
  
  \end{column}

  \begin{column}{\sepwid}\end{column} % Empty spacer column

  \begin{column}{\onecolwid} % The second column
  
  
       \begin{alertblock}{Goal}
         Extend the search to make more specifications refutationally complete.
       \end{alertblock}
  
    \vskip8mm
    
    \begin{block}{Problem}
      \vskip8mm
      {\large \textbf{The non-commutativity of conjunction. }}
      
      %\setbeamertemplate{caption}{\raggedright\insertcaption\par}
      
      \begin{figure}
        %\large{Information passing}\\
        \begin{tikzpicture}%[scale=1.2]
          \node[text width=7cm] at (0,0) {\huge $g_1 \wedge g_2$};
          \draw [->, line width=13, blue] (-8,0) -- (-4,0);
          \draw [->, line width=13, blue] (4,0) -- (8,0); 
          \draw [->, line width=13, blue] (-2.5,1.5) .. controls (-1,4) and (1,4) .. (2.5,1.5);
          \draw [->, line width=13, blue] (2.5,-1.5) .. controls (1,-4) and (-1,-4) .. (-2.5,-1.5);
          \draw [line width=13, red] (-1,-4.25) -- (1,-2.25); 
          \draw [line width=13, red] (-1,-2.25) -- (1,-4.25);
        \end{tikzpicture}
        \caption{Information flow}
      \end{figure}
      
      If $g_1$ diverges, then $g_1 \wedge g_2$ diverges. 
      \vskip8mm
    \end{block}    
    
    \begin{block}{Approach}
       \vskip8mm
      \textbf{Idea:}
      	\begin{enumerate}
      	\justifying
      	\item detect divergence dynamically;
      	\item swap the constituents of enclosing conjunction;
      	\item resume the search.
      	\end{enumerate}
      
      \vskip8mm
      \textbf{Divergence test:}
      \vskip8mm
      If arguments in a recursive call are more general, than those of the enclosing one, then the search will diverge.
      \vskip8mm
      
      \end{block}
   
    \begin{block}{Results}
    
    \vskip5mm
    
    \begin{itemize}
      \item Prototype implementation for deeply embedded version for OCaml.
      \item Semantics for terminating MinKanren programs (convenient and extended search), proof of divergence test correctness and refutational completeness preserving.
    \end{itemize}
    \vskip8mm  
    
  \end{block}
  
   \begin{block}{References}
      \vskip7mm
      \printbibliography

    \end{block}
    %Extentions allows to construct refutationally complete versions for new relations

     %\begin{exampleblock}{Permutations}
        %\justifying
        %\lstinputlisting{sorto.ml}
        %\bigskip
        %For termination we need

        %\begin{itemize}
        %  \item order $1 \to 2$ for forward evaluation
        %  \item order $2 \to 1$ for reverse evaluation
        %\end{itemize}
 
       %\bigskip

        %Calculating all permutations via sorting:
        %\bigskip
        %\lstinputlisting{permo.ml}
        %\bigskip
        %requires evaluation of \lstinline|sort$^o$| in \emph{both} directions simultaneously.

        %\bigskip
        %\justifying
        %\textbf{Conventional search:} diverges regardless the direction, unreasonably slow.
        
        %\textbf{Extended search:} terminates regardless the direction, reasonably slow.
	 %\end{exampleblock}
    
     %Extended search reconstructs (experimentally) \\ the way of information propagation for each call.

     %Multidirectional calls (like in {\ttfamily perm$^o$}) converge.
      %\bigskip
      %or simplify existing ones
      
     %Extention allows to write refutationallu specifications naively.

      %\begin{exampleblock}{Binary Division}
        %\justifying
        %Definition-based natural implementation:

        %\bigskip
        %\lstinputlisting{divoeasy.ml}
        %\bigskip
        
        %is not refutationally complete under the convential search.
        
        %Fix: use a tricky solution [Kiselyov, Byrd, Friedman, Shan, 2008]:
 
        %\lstinputlisting[basicstyle=\tiny]{divo.ml}

        %... or \textbf{extended search}.        
      %\end{exampleblock}
      
    %\end{block}

  \end{column}

  \begin{column}{\sepwid}\end{column} % Empty spacer column

 
\end{columns}

\end{frame} % End of the enclosing frame

\end{document}
